{"version":3,"file":"connection-path-plugin.esm.js","sources":["../src/path-factory.js","../src/transformers.js","../src/types.js","../src/utils.js","../src/index.js"],"sourcesContent":["import * as d3 from 'd3-shape';\n\nexport class PathFactory {\n\n    constructor(points, curve) {\n        this.points = points;\n        this.curve = curve;\n    }\n\n    line(transformer) {\n        let points = transformer(this.points);\n\n        return d3.line()\n            .x(d => d[0])\n            .y(d => d[1])\n            .curve(this.curve)\n            (points)\n    }\n\n    getData(transformer, options, data) {\n        return this.line(transformer(options, data));\n    }\n}","export default {\n  LINEAR:\n    () =>\n    ([x1, y1, x2, y2]) => {\n      return [\n        [x1, y1],\n        [x2, y2],\n      ]\n    },\n  DEFAULT:\n    ({ vertical = false, curvature = 0.4 }) =>\n    ([x1, y1, x2, y2]) => {\n      const p1 = [x1, y1]\n      const p4 = [x2, y2]\n\n      if (vertical) {\n        ;[x1, y1] = [y1, x1]\n        ;[x2, y2] = [y2, x2]\n      }\n\n      const c1 = x1 + Math.abs(x2 - x1) * curvature\n      const c2 = x2 - Math.abs(x2 - x1) * curvature\n      const p2 = vertical ? [y1, c1] : [c1, y1]\n      const p3 = vertical ? [y2, c2] : [c2, y2]\n\n      return [p1, p2, p3, p4]\n    },\n  VERTICAL_COMBO:\n    ({ curvature = 0.4 }, data) =>\n    ([x1, y1, x2, y2]) => {\n      const p1 = [x1, y1]\n      const p4 = [x2, y2]\n      let vertical_l = false\n      let vertical_r = false\n      if (data.connection) {\n        console.log(\"data.connection.input :>> \", data.connection.input)\n        console.log(\"data.connection.output :>> \", data.connection.output)\n\n        if (data.connection.input.vertical) {\n          vertical_r = true\n        }\n        if (data.connection.output.vertical) {\n          vertical_l = true\n        }\n      }\n      if (vertical_l) {\n        ;[x1, y1] = [y1, x1]\n      }\n      if (vertical_r) {\n        ;[x2, y2] = [y2, x2]\n      }\n      const c1 = x1 + Math.abs(x2 - x1) * curvature\n      const c2 = x2 - Math.abs(x2 - x1) * curvature\n      const p2 = vertical_l ? [y1, c1] : [c1, y1]\n      const p3 = vertical_r ? [y2, c2] : [c2, y2]\n\n      return [p1, p2, p3, p4]\n    },\n}\n","export default {\n    DEFAULT: 'DEFAULT',\n    LINEAR: 'LINEAR'\n}","export function getAngle({ x: x1, y: y1 }, { x: x2, y: y2 }) {\n    const dx = x1 - x2;\n    const dy = y1 - y2;\n\t\n    return 180 * Math.atan2(dy, dx) / Math.PI;\n}\n\nexport function getTransformAlong(path, offset, delta = 1, needRotate = true) {\n    const length = path.getTotalLength() * delta;\n    const p1 = path.getPointAtLength(length + offset);\n    const p2 = path.getPointAtLength(length);\n    const angle = 180 + (needRotate ? getAngle(p1, p2) : 0);\n\n    return `translate(${p1.x}, ${p1.y}) rotate(${angle})`;\n}","import * as d3 from 'd3-shape';\nimport { PathFactory } from './path-factory';\nimport Transformer from './transformers';\nimport Type from './types';\nimport { getTransformAlong } from './utils';\n\nfunction install(editor, { type, transformer, arrow, curve, options = {} }) {\n    type = type || Type.DEFAULT;\n    curve = curve || d3.curveBasis;\n\n    if (transformer && typeof transformer !== 'function') throw new Error('transformer property must be a function');\n    if (!Transformer[type]) throw new Error(`transformer with type ${type} doesn't exist`);\n    \n    editor.on('connectionpath', data => {\n        const factory = new PathFactory(data.points, curve);\n\n        data.d = factory.getData(transformer || Transformer[type], options, data);\n    });\n\n    if (arrow) {\n        editor.on('renderconnection', ({ el }) => {\n            const path = el.querySelector('path');\n            const marker = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n            el.querySelector('svg').appendChild(marker);\n            marker.classList.add('marker');\n            marker.setAttribute('fill', arrow.color || 'steelblue');\n            marker.setAttribute('d', arrow.marker || 'M-5,-10 L-5,10 L20,0 z');\n\n            marker.setAttribute('transform', getTransformAlong(path, -25));\n        });\n\n        editor.on('updateconnection', ({ el }) => {\n            const path = el.querySelector('path');\n            const marker = el.querySelector('.marker');\n\n            marker.setAttribute('transform', getTransformAlong(path, -25));\n        });\n    }\n}\nexport { getTransformAlong } from './utils';\n\nexport default {\n    install,\n    ...d3,\n    ...Type\n}"],"names":["PathFactory","points","curve","transformer","d3","x","d","y","options","data","line","LINEAR","x1","y1","x2","y2","DEFAULT","vertical","curvature","p1","p4","c1","Math","abs","c2","p2","p3","VERTICAL_COMBO","vertical_l","vertical_r","connection","console","log","input","output","getAngle","dx","dy","atan2","PI","getTransformAlong","path","offset","delta","needRotate","length","getTotalLength","getPointAtLength","angle","install","editor","type","arrow","Type","Error","Transformer","on","factory","getData","el","querySelector","marker","document","createElementNS","appendChild","classList","add","setAttribute","color"],"mappings":"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"}