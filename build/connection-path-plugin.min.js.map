{"version":3,"file":"connection-path-plugin.min.js","sources":["../src/path-factory.js","../src/transformers.js","../src/types.js","../src/utils.js","../src/index.js"],"sourcesContent":["import * as d3 from 'd3-shape';\n\nexport class PathFactory {\n\n    constructor(points, curve) {\n        this.points = points;\n        this.curve = curve;\n    }\n\n    line(transformer) {\n        let points = transformer(this.points);\n\n        return d3.line()\n            .x(d => d[0])\n            .y(d => d[1])\n            .curve(this.curve)\n            (points)\n    }\n\n    getData(transformer, options) {\n        return this.line(transformer(options,data));\n    }\n}","export default {\n    LINEAR: () => ([x1, y1, x2, y2]) => {\n        return [[x1, y1], [x2, y2]];\n    },\n    DEFAULT: ({ vertical = false, curvature = 0.4 }) => ([x1, y1, x2, y2]) => {\n        const p1 = [x1, y1];\n        const p4 = [x2, y2];\n\n        if (vertical) {\n            [x1, y1] = [y1, x1];\n            [x2, y2] = [y2, x2];\n        }\n\n        const c1 = x1 + Math.abs(x2 - x1) * curvature;\n        const c2 = x2 - Math.abs(x2 - x1) * curvature;\n        const p2 = vertical ? [y1, c1] : [c1, y1];\n        const p3 = vertical ? [y2, c2] : [c2, y2];\n\n        return [p1, p2, p3, p4];\n    },\n    VERTICAL_COMBO: ({ curvature = 0.4 },data) => ([x1, y1, x2, y2]) => {\n        const p1 = [x1, y1];\n        const p4 = [x2, y2];\n        let vertical_l=false\n        let vertical_r=false\n        if(data.connection) {\n            if(data.connection.input.vertical){\n                vertical_r=true\n            }\n            if(data.connection.output.vertical){\n                vertical_l=true\n            }\n \n        }\n        if (vertical_l){\n            [x1, y1] = [y1, x1];\n        }\n        if (vertical_r){\n            [x2, y2] = [y2, x2];\n        }\n        const c1 = x1 + Math.abs(x2 - x1) * curvature;\n        const c2 = x2 - Math.abs(x2 - x1) * curvature;\n        const p2 = vertical_l ? [y1, c1] : [c1, y1];\n        const p3 = vertical_r ? [y2, c2] : [c2, y2];\n \n        return [p1, p2, p3, p4];\n    }\n}","export default {\n    DEFAULT: 'DEFAULT',\n    LINEAR: 'LINEAR'\n}","export function getAngle({ x: x1, y: y1 }, { x: x2, y: y2 }) {\n    const dx = x1 - x2;\n    const dy = y1 - y2;\n\t\n    return 180 * Math.atan2(dy, dx) / Math.PI;\n}\n\nexport function getTransformAlong(path, offset, delta = 1, needRotate = true) {\n    const length = path.getTotalLength() * delta;\n    const p1 = path.getPointAtLength(length + offset);\n    const p2 = path.getPointAtLength(length);\n    const angle = 180 + (needRotate ? getAngle(p1, p2) : 0);\n\n    return `translate(${p1.x}, ${p1.y}) rotate(${angle})`;\n}","import * as d3 from 'd3-shape';\nimport { PathFactory } from './path-factory';\nimport Transformer from './transformers';\nimport Type from './types';\nimport { getTransformAlong } from './utils';\n\nfunction install(editor, { type, transformer, arrow, curve, options = {} }) {\n    type = type || Type.DEFAULT;\n    curve = curve || d3.curveBasis;\n\n    if (transformer && typeof transformer !== 'function') throw new Error('transformer property must be a function');\n    if (!Transformer[type]) throw new Error(`transformer with type ${type} doesn't exist`);\n    \n    editor.on('connectionpath', data => {\n        const { points } = data;\n        const factory = new PathFactory(points, curve);\n\n        data.d = factory.getData(transformer || Transformer[type], options, data);\n    });\n\n    if (arrow) {\n        editor.on('renderconnection', ({ el }) => {\n            const path = el.querySelector('path');\n            const marker = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n            el.querySelector('svg').appendChild(marker);\n            marker.classList.add('marker');\n            marker.setAttribute('fill', arrow.color || 'steelblue');\n            marker.setAttribute('d', arrow.marker || 'M-5,-10 L-5,10 L20,0 z');\n\n            marker.setAttribute('transform', getTransformAlong(path, -25));\n        });\n\n        editor.on('updateconnection', ({ el }) => {\n            const path = el.querySelector('path');\n            const marker = el.querySelector('.marker');\n\n            marker.setAttribute('transform', getTransformAlong(path, -25));\n        });\n    }\n}\nexport { getTransformAlong } from './utils';\n\nexport default {\n    install,\n    ...d3,\n    ...Type\n}"],"names":["PathFactory","points","curve","transformer","this","d3","x","d","y","options","line","data","LINEAR","DEFAULT","vertical","curvature","x1","y1","x2","y2","p1","p4","c1","Math","abs","c2","VERTICAL_COMBO","vertical_l","vertical_r","connection","input","output","getTransformAlong","path","offset","dx","dy","delta","needRotate","length","getTotalLength","getPointAtLength","p2","angle","atan2","PI","install","editor","type","arrow","Type","Error","Transformer","on","factory","getData","el","querySelector","marker","document","createElementNS","appendChild","classList","add","setAttribute","color"],"mappings":"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"}