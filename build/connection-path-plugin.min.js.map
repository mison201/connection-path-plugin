{"version":3,"file":"connection-path-plugin.min.js","sources":["../src/path-factory.js","../src/transformers.js","../src/types.js","../src/utils.js","../src/index.js"],"sourcesContent":["import * as d3 from 'd3-shape';\n\nexport class PathFactory {\n\n    constructor(points, curve) {\n        this.points = points;\n        this.curve = curve;\n    }\n\n    line(transformer) {\n        let points = transformer(this.points);\n\n        return d3.line()\n            .x(d => d[0])\n            .y(d => d[1])\n            .curve(this.curve)\n            (points)\n    }\n\n    getData(transformer, options, data) {\n        return this.line(transformer(options, data));\n    }\n}","export default {\n  LINEAR:\n    () =>\n    ([x1, y1, x2, y2]) => {\n      return [\n        [x1, y1],\n        [x2, y2],\n      ]\n    },\n  DEFAULT:\n    ({ vertical = false, curvature = 0.4 }) =>\n    ([x1, y1, x2, y2]) => {\n      const p1 = [x1, y1]\n      const p4 = [x2, y2]\n\n      if (vertical) {\n        ;[x1, y1] = [y1, x1]\n        ;[x2, y2] = [y2, x2]\n      }\n\n      const c1 = x1 + Math.abs(x2 - x1) * curvature\n      const c2 = x2 - Math.abs(x2 - x1) * curvature\n      const p2 = vertical ? [y1, c1] : [c1, y1]\n      const p3 = vertical ? [y2, c2] : [c2, y2]\n\n      return [p1, p2, p3, p4]\n    },\n  VERTICAL_COMBO:\n    ({ curvature = 0.4 }, data) =>\n    ([x1, y1, x2, y2]) => {\n      const p1 = [x1, y1]\n      const p4 = [x2, y2]\n      let vertical_l = false\n      let vertical_r = false\n      console.log(\"data :>> \", data)\n      if (data.connection) {\n        console.log(\"data.connection.input :>> \", data.connection.input)\n        console.log(\"data.connection.output :>> \", data.connection.output)\n\n        if (data.connection.input.vertical) {\n          vertical_r = true\n        }\n        if (data.connection.output.vertical) {\n          vertical_l = true\n        }\n      }\n      if (vertical_l) {\n        ;[x1, y1] = [y1, x1]\n      }\n      if (vertical_r) {\n        ;[x2, y2] = [y2, x2]\n      }\n      const c1 = x1 + Math.abs(x2 - x1) * curvature\n      const c2 = x2 - Math.abs(x2 - x1) * curvature\n      const p2 = vertical_l ? [y1, c1] : [c1, y1]\n      const p3 = vertical_r ? [y2, c2] : [c2, y2]\n\n      return [p1, p2, p3, p4]\n    },\n}\n","export default {\n    DEFAULT: 'DEFAULT',\n    LINEAR: 'LINEAR'\n}","export function getAngle({ x: x1, y: y1 }, { x: x2, y: y2 }) {\n    const dx = x1 - x2;\n    const dy = y1 - y2;\n\t\n    return 180 * Math.atan2(dy, dx) / Math.PI;\n}\n\nexport function getTransformAlong(path, offset, delta = 1, needRotate = true) {\n    const length = path.getTotalLength() * delta;\n    const p1 = path.getPointAtLength(length + offset);\n    const p2 = path.getPointAtLength(length);\n    const angle = 180 + (needRotate ? getAngle(p1, p2) : 0);\n\n    return `translate(${p1.x}, ${p1.y}) rotate(${angle})`;\n}","import * as d3 from 'd3-shape';\nimport { PathFactory } from './path-factory';\nimport Transformer from './transformers';\nimport Type from './types';\nimport { getTransformAlong } from './utils';\n\nfunction install(editor, { type, transformer, arrow, curve, options = {} }) {\n    type = type || Type.DEFAULT;\n    curve = curve || d3.curveBasis;\n\n    if (transformer && typeof transformer !== 'function') throw new Error('transformer property must be a function');\n    if (!Transformer[type]) throw new Error(`transformer with type ${type} doesn't exist`);\n    \n    editor.on('connectionpath', data => {\n        const factory = new PathFactory(data.points, curve);\n\n        data.d = factory.getData(transformer || Transformer[type], options, data);\n    });\n\n    if (arrow) {\n        editor.on('renderconnection', ({ el }) => {\n            const path = el.querySelector('path');\n            const marker = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n            el.querySelector('svg').appendChild(marker);\n            marker.classList.add('marker');\n            marker.setAttribute('fill', arrow.color || 'steelblue');\n            marker.setAttribute('d', arrow.marker || 'M-5,-10 L-5,10 L20,0 z');\n\n            marker.setAttribute('transform', getTransformAlong(path, -25));\n        });\n\n        editor.on('updateconnection', ({ el }) => {\n            const path = el.querySelector('path');\n            const marker = el.querySelector('.marker');\n\n            marker.setAttribute('transform', getTransformAlong(path, -25));\n        });\n    }\n}\nexport { getTransformAlong } from './utils';\n\nexport default {\n    install,\n    ...d3,\n    ...Type\n}"],"names":["PathFactory","points","curve","transformer","this","d3","x","d","y","options","data","line","LINEAR","DEFAULT","vertical","curvature","x1","y1","x2","y2","p1","p4","c1","Math","abs","c2","VERTICAL_COMBO","vertical_l","vertical_r","console","log","connection","input","output","getTransformAlong","path","offset","dx","dy","delta","needRotate","length","getTotalLength","getPointAtLength","p2","angle","atan2","PI","install","editor","type","arrow","Type","Error","Transformer","on","factory","getData","el","querySelector","marker","document","createElementNS","appendChild","classList","add","setAttribute","color"],"mappings":"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"}