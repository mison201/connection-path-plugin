{"version":3,"file":"connection-path-plugin.common.js","sources":["../src/path-factory.js","../src/transformers.js","../src/types.js","../src/utils.js","../src/index.js"],"sourcesContent":["import * as d3 from 'd3-shape';\n\nexport class PathFactory {\n\n    constructor(points, curve) {\n        this.points = points;\n        this.curve = curve;\n    }\n\n    line(transformer) {\n        let points = transformer(this.points);\n\n        return d3.line()\n            .x(d => d[0])\n            .y(d => d[1])\n            .curve(this.curve)\n            (points)\n    }\n\n    getData(transformer, options, data) {\n        return this.line(transformer(options, data));\n    }\n}","export default {\n    LINEAR: () => ([x1, y1, x2, y2]) => {\n        return [[x1, y1], [x2, y2]];\n    },\n    DEFAULT: ({ vertical = false, curvature = 0.4 }) => ([x1, y1, x2, y2]) => {\n        const p1 = [x1, y1];\n        const p4 = [x2, y2];\n\n        if (vertical) {\n            [x1, y1] = [y1, x1];\n            [x2, y2] = [y2, x2];\n        }\n\n        const c1 = x1 + Math.abs(x2 - x1) * curvature;\n        const c2 = x2 - Math.abs(x2 - x1) * curvature;\n        const p2 = vertical ? [y1, c1] : [c1, y1];\n        const p3 = vertical ? [y2, c2] : [c2, y2];\n\n        return [p1, p2, p3, p4];\n    },\n    VERTICAL_COMBO: ({ curvature = 0.4 }, data) => ([x1, y1, x2, y2]) => {\n        const p1 = [x1, y1];\n        const p4 = [x2, y2];\n        let vertical_l=false\n        let vertical_r=false\n        if(data.connection) {\n            if(data.connection.input.vertical){\n                vertical_r=true\n            }\n            if(data.connection.output.vertical){\n                vertical_l=true\n            }\n \n        }\n        if (vertical_l){\n            [x1, y1] = [y1, x1];\n        }\n        if (vertical_r){\n            [x2, y2] = [y2, x2];\n        }\n        const c1 = x1 + Math.abs(x2 - x1) * curvature;\n        const c2 = x2 - Math.abs(x2 - x1) * curvature;\n        const p2 = vertical_l ? [y1, c1] : [c1, y1];\n        const p3 = vertical_r ? [y2, c2] : [c2, y2];\n \n        return [p1, p2, p3, p4];\n    }\n}","export default {\n    DEFAULT: 'DEFAULT',\n    LINEAR: 'LINEAR'\n}","export function getAngle({ x: x1, y: y1 }, { x: x2, y: y2 }) {\n    const dx = x1 - x2;\n    const dy = y1 - y2;\n\t\n    return 180 * Math.atan2(dy, dx) / Math.PI;\n}\n\nexport function getTransformAlong(path, offset, delta = 1, needRotate = true) {\n    const length = path.getTotalLength() * delta;\n    const p1 = path.getPointAtLength(length + offset);\n    const p2 = path.getPointAtLength(length);\n    const angle = 180 + (needRotate ? getAngle(p1, p2) : 0);\n\n    return `translate(${p1.x}, ${p1.y}) rotate(${angle})`;\n}","import * as d3 from 'd3-shape';\nimport { PathFactory } from './path-factory';\nimport Transformer from './transformers';\nimport Type from './types';\nimport { getTransformAlong } from './utils';\n\nfunction install(editor, { type, transformer, arrow, curve, options = {} }) {\n    type = type || Type.DEFAULT;\n    curve = curve || d3.curveBasis;\n\n    if (transformer && typeof transformer !== 'function') throw new Error('transformer property must be a function');\n    if (!Transformer[type]) throw new Error(`transformer with type ${type} doesn't exist`);\n    \n    editor.on('connectionpath', data => {\n        const factory = new PathFactory(data.points, curve);\n\n        data.d = factory.getData(transformer || Transformer[type], options, data);\n    });\n\n    if (arrow) {\n        editor.on('renderconnection', ({ el }) => {\n            const path = el.querySelector('path');\n            const marker = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n            el.querySelector('svg').appendChild(marker);\n            marker.classList.add('marker');\n            marker.setAttribute('fill', arrow.color || 'steelblue');\n            marker.setAttribute('d', arrow.marker || 'M-5,-10 L-5,10 L20,0 z');\n\n            marker.setAttribute('transform', getTransformAlong(path, -25));\n        });\n\n        editor.on('updateconnection', ({ el }) => {\n            const path = el.querySelector('path');\n            const marker = el.querySelector('.marker');\n\n            marker.setAttribute('transform', getTransformAlong(path, -25));\n        });\n    }\n}\nexport { getTransformAlong } from './utils';\n\nexport default {\n    install,\n    ...d3,\n    ...Type\n}"],"names":["PathFactory","points","curve","transformer","d3","x","d","y","options","data","line","LINEAR","x1","y1","x2","y2","DEFAULT","vertical","curvature","p1","p4","c1","Math","abs","c2","p2","p3","VERTICAL_COMBO","vertical_l","vertical_r","connection","input","output","getAngle","dx","dy","atan2","PI","getTransformAlong","path","offset","delta","needRotate","length","getTotalLength","getPointAtLength","angle","install","editor","type","arrow","Type","Error","Transformer","on","factory","getData","el","querySelector","marker","document","createElementNS","appendChild","classList","add","setAttribute","color"],"mappings":"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"}